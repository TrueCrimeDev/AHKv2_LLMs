<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Post - AHKv2 &amp; LLMs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/marked@11.1.0/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked-highlight@2.1.0/lib/index.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github-dark.min.css">
  <style>
    .article-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 24px;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 20px;
    }

    .back-link:hover { color: var(--accent); }

    .article-header {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 24px;
      margin-bottom: 20px;
    }

    .article-date {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .article-title {
      margin: 0 0 12px;
      font-size: 28px;
      font-weight: 600;
      line-height: 1.3;
    }

    .article-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .article-body {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 32px;
      line-height: 1.8;
    }

    .article-body h1,
    .article-body h2,
    .article-body h3 {
      margin-top: 1.5em;
      margin-bottom: 0.5em;
      line-height: 1.3;
      color: var(--text-primary);
    }

    .article-body h2 {
      font-size: 22px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border-muted);
    }

    .article-body h3 { font-size: 18px; }

    .article-body p { margin: 0 0 1em; }

    .article-body ul, .article-body ol {
      margin: 0 0 1em 1.5em;
    }

    .article-body li { margin: 0.4em 0; }

    .article-body strong { color: var(--text-primary); }

    .article-body a { border-bottom: 1px solid transparent; }
    .article-body a:hover { border-bottom-color: var(--accent); }

    .loading {
      text-align: center;
      color: var(--text-muted);
      padding: 40px;
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <span class="logo-mark">AHK</span>
        <span class="logo-text">v2 &amp; LLMs</span>
      </a>
      <nav class="nav">
        <a href="index.html" class="nav-link">Home</a>
        <a href="index.html#posts" class="nav-link">Posts</a>
        <a href="https://www.autohotkey.com/docs/v2/" target="_blank" class="nav-link">AHK Docs</a>
      </nav>
    </div>
  </header>

  <main class="article-container">
    <a class="back-link" href="index.html">&larr; Back to all posts</a>

    <header class="article-header">
      <div class="article-date" id="article-date">Loading...</div>
      <h1 class="article-title" id="article-title">Loading...</h1>
      <div class="article-tags" id="article-tags"></div>
    </header>

    <article id="content" class="article-body loading">Loading post...</article>
  </main>

  <footer class="site-footer">
    <span>&copy; 2025 AHKv2 &amp; LLMs</span>
    <div class="footer-links">
      <a href="index.html">Home</a>
      <a href="https://github.com/AutoHotkey" target="_blank">GitHub</a>
    </div>
  </footer>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const slug = urlParams.get('slug');

    async function fetchManifest() {
      const response = await fetch('posts/posts.json');
      if (!response.ok) throw new Error('Manifest missing');
      return response.json();
    }

    function applyMetadata(meta) {
      if (meta?.title) {
        document.getElementById('article-title').textContent = meta.title;
        document.title = meta.title + ' - AHKv2 & LLMs';
      }

      if (meta?.date) {
        const date = new Date(meta.date).toLocaleDateString(undefined, {
          year: 'numeric', month: 'long', day: 'numeric'
        });
        document.getElementById('article-date').textContent = date;
      }

      if (meta?.tags?.length) {
        document.getElementById('article-tags').innerHTML =
          meta.tags.map(tag => `<span class="tag">${tag}</span>`).join('');
      }
    }

    async function renderPost(path, meta) {
      try {
        const response = await fetch(path);
        if (!response.ok) throw new Error('Post not found');
        const markdown = await response.text();

        marked.use(markedHighlight.markedHighlight({
          langPrefix: 'hljs language-',
          highlight: function(code, lang) {
            if (lang && hljs.getLanguage(lang)) {
              return hljs.highlight(code, { language: lang }).value;
            }
            return hljs.highlightAuto(code).value;
          }
        }));

        marked.setOptions({
          breaks: true,
          gfm: true
        });

        const html = marked.parse(markdown);
        document.getElementById('content').classList.remove('loading');
        document.getElementById('content').innerHTML = html;
        if (meta) applyMetadata(meta);
      } catch (error) {
        document.getElementById('content').innerHTML = `<p>Error: ${error.message}</p>`;
      }
    }

    async function init() {
      if (!slug) {
        document.getElementById('content').innerHTML = '<p>No post specified.</p>';
        return;
      }

      try {
        const manifest = await fetchManifest();
        const meta = manifest.find(entry => entry.slug === slug);
        if (!meta) throw new Error('Post not found');
        renderPost(meta.path, meta);
      } catch (error) {
        document.getElementById('content').innerHTML = `<p>Error: ${error.message}</p>`;
      }
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
